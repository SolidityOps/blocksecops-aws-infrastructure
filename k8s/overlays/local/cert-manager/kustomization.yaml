apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Cert-Manager for Local Development
# Self-signed certificates for local services
namespace: cert-manager-local

resources:
- namespace.yaml
- ../../../base/cert-manager/
- self-signed-issuer.yaml
- local-wildcard-certificate.yaml

patches:
- path: cert-manager-patch.yaml
  target:
    kind: Deployment
    name: cert-manager
- path: cert-manager-cainjector-patch.yaml
  target:
    kind: Deployment
    name: cert-manager-cainjector
- path: cert-manager-webhook-patch.yaml
  target:
    kind: Deployment
    name: cert-manager-webhook
- target:
    kind: ClusterRoleBinding
    name: cert-manager-controller
  patch: |-
    - op: replace
      path: /subjects/0/namespace
      value: "cert-manager-local"
- target:
    kind: ClusterRoleBinding
    name: cert-manager-cainjector
  patch: |-
    - op: replace
      path: /subjects/0/namespace
      value: "cert-manager-local"
- target:
    kind: ClusterRoleBinding
    name: cert-manager-webhook:subjectaccessreviews
  patch: |-
    - op: replace
      path: /subjects/0/namespace
      value: "cert-manager-local"

labels:
- includeSelectors: true
  pairs:
    app.kubernetes.io/component: certificate-management
    app.kubernetes.io/part-of: blocksecops-platform
    app.kubernetes.io/managed-by: kustomize
    environment: local
    team: infrastructure