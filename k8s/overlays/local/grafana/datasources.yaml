apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  labels:
    app: grafana
data:
  datasources.yaml: |
    apiVersion: 1

    deleteDatasources:
    - name: Prometheus
      orgId: 1

    datasources:
    - name: Prometheus
      type: prometheus
      access: proxy
      orgId: 1
      url: http://prometheus.prometheus-local.svc.cluster.local:9090
      isDefault: true
      version: 1
      editable: false
      jsonData:
        httpMethod: POST
        manageAlerts: true
        alertmanagerUid: alertmanager

    - name: Jaeger
      type: jaeger
      access: proxy
      orgId: 1
      url: http://tracing.istio-system.svc.cluster.local:80
      isDefault: false
      version: 1
      editable: false
      jsonData:
        tracesToLogs:
          datasourceUid: 'loki'
          tags: ['job', 'instance', 'pod', 'namespace']
          mappedTags: [
            {
              key: 'service.name',
              value: 'service'
            }
          ]
          mapTagNamesEnabled: false
          spanStartTimeShift: '1h'
          spanEndTimeShift: '1h'
          filterByTraceID: false
          filterBySpanID: false