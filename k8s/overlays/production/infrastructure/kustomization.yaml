apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: infrastructure-production
  annotations:
    config.kubernetes.io/local-config: "true"

resources:
  - ../../../base/aws-load-balancer-controller
  - ../../../base/cert-manager
  - ../../../base/external-secrets
  - ../../../base/monitoring

patches:
  - path: alb-controller-patch.yaml
    target:
      kind: ServiceAccount
      name: aws-load-balancer-controller
      namespace: kube-system
  - path: alb-controller-deployment-patch.yaml
    target:
      kind: Deployment
      name: aws-load-balancer-controller
      namespace: kube-system
  - path: cert-manager-patch.yaml
    target:
      kind: ClusterIssuer
      name: letsencrypt-staging
  - path: cert-manager-patch.yaml
    target:
      kind: ClusterIssuer
      name: letsencrypt-production
  - path: external-secrets-patch.yaml
    target:
      kind: ServiceAccount
      name: external-secrets
      namespace: external-secrets
  - path: external-secrets-store-patch.yaml
    target:
      kind: ClusterSecretStore
      name: vault-backend
  - path: external-secrets-store-patch.yaml
    target:
      kind: ClusterSecretStore
      name: aws-secrets-manager

namespace: production-infrastructure

commonLabels:
  environment: production
  app.kubernetes.io/instance: production