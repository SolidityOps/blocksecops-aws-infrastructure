apiVersion: v1
kind: ConfigMap
metadata:
  name: node-group-config
  namespace: kube-system
data:
  node.group.name: "production-main"
  node.group.instance.types: "t3.large,t3.xlarge,m5.large"
  node.group.capacity.type: "ON_DEMAND"
  node.group.disk.size: "50"  # Larger disk for production
  node.group.desired.size: "3"
  node.group.max.size: "10"
  node.group.min.size: "2"
  node.group.ami.type: "AL2_x86_64"
  node.group.environment: "production"
  node.group.labels: "environment=production,node-type=general,tier=production"
  node.group.high.availability: "true"
  node.group.multi.az: "true"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cluster-autoscaler
  namespace: cluster-autoscaler
spec:
  template:
    metadata:
      labels:
        environment: production
        tier: production
    spec:
      nodeSelector:
        kubernetes.io/os: linux
        environment: production
      tolerations:
        - effect: NoSchedule
          key: node-role.kubernetes.io/control-plane
        - effect: NoSchedule
          key: environment
          value: production
          operator: Equal
        - effect: NoSchedule
          key: tier
          value: production
          operator: Equal
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: topology.kubernetes.io/zone
          whenUnsatisfiable: DoNotSchedule
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: cluster-autoscaler